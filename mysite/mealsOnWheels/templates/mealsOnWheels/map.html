<!DOCTYPE HTML>
{% load staticfiles %}
<!--
	Dopetrope by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Meals on Wheels | Map</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><link type="text/css" rel="stylesheet" href="{% static 'mealsOnWheels/js/ie/html5shiv.js' %}"/></script><![endif]-->
		<link type="text/css" rel="stylesheet" href="{% static 'mealsOnWheels/css/main.css' %}"/>
		<!--[if lte IE 8]><link type="text/css" rel="stylesheet" href="{% static 'mealsOnWheels/css/ie8.css' %}"/><![endif]-->
	    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>


	    <script>
		<!--http://stackoverflow.com/questions/15144691/google-maps-multiple-marker-from-extern-json-->
		var map;
		var downtownVancouver = new google.maps.LatLng(49.28,-123.12);

		function initialize() {
		  var mapOptions = {
		    zoom: 14,
		    center: downtownVancouver,
		    mapTypeId:google.maps.MapTypeId.ROADMAP
		  }

        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);



		function run(name){

		tag = name.replace(/\s+/g, '').replace(/\./g,'').replace(/-/g, '').replace(/\'/g, '');
		tag = tag
		tag = tag.toLowerCase()
		$(function(){
	   	    	var feed = new Instafeed({
	           	    get: 'tagged',
	               	tagName: tag,
	               	clientId: 'bcd816efac8548f0a76c300d2ffd7005',
	               	limit: 6,
	               	error: function(string){
	               		$("#instafeed").append('<img id="default-instagram-background">');
	              	}
		        });
        	        feed.run();
            });

		}
        $(document).ready(function() {
            $.getJSON("/mealsOnWheels/food_trucks", function(food_trucks_json) {
                $.each(food_trucks_json, function(key, data) {
                    var latLng = new google.maps.LatLng(data.latitude, data.longitude);

                    // Creating a marker and putting it on the map
                    var marker = new google.maps.Marker({
                    position: latLng,
                    title: data.name
                        });

                        marker.setMap(map);
                        var infowindow = new google.maps.InfoWindow({
							content: data.name
							});

                        google.maps.event.addListener(marker, 'click', function() {
							infowindow.open(map,marker);

							$( "#selected-food-truck-details p" )
							.html( data.description );
							$( "#selected-food-truck-details h3" )
							.html( data.name );

                            $( "#instafeed")
                            .html ( "" );
							run(data.name);

						});

                    });
                });
            });

            <!--http://stackoverflow.com/questions/743214/how-do-i-resize-a-google-map-with-javascript-after-it-has-loaded-->
			$(window).resize(function() {
		        google.maps.event.trigger(map, "resize");
		    });
        };

		google.maps.event.addDomListener(window, 'load', initialize);
        </script>
	</head>
	<body class="right-sidebar">
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header-wrapper">
					<div id="header">

						<!-- Logo -->
							<h1><img id="meals-on-wheels-logo"></h1>

						<!-- Nav -->
							<nav id="nav">
								<ul>
									<li><a href="{% url 'mealsOnWheels:index' %}">Home</a></li>
									<li class="current"><a href="{% url 'mealsOnWheels:map' %}">Map</a></li>
									<li><a href="{% url 'mealsOnWheels:profile' %}">Profile</a></li>
									<li><a href="/mealsOnWheels/logout/">Logout</a></li>
								</ul>
							</nav>

					</div>
				</div>

			<!-- Main -->
				<div id="main-wrapper">
					<div class="container">
						<div class="row">
							<div id="map-row" class="9u 12u(mobile)">

								<!-- Content -->
									<article class="box post">
										<div id="map-canvas">
									</article>

							</div>
							<div id="food-truck-details-container" class="3u 12u(mobile)">

								<!-- Sidebar -->
									<section id="selected-food-truck-details" class="box">
										<header>
											<h3>Search for Food Trucks</h3>
										</header>
										<p>
											Click on a food truck marker to view its info.
										</p>
									</section>
									<section id="selected-food-truck-instagram" class="box">
										<div id="instafeed"><p><img id="default-instagram-background"></p></div>
									</section>

							</div>
						</div>
					</div>
				</div>

			<!-- Footer -->
				<div id="footer-wrapper">
					<section id="footer" class="container">
						<div class="row">
							<div class="4u 12u(mobile)">
								<section>
									<header>
										<h3>Food truck data provided by</h3>
									</header>
									<ul class="divided">
										<li><a href="http://data.vancouver.ca/">City of Vancouver</a></li>
									</ul>
								</section>
							</div>
							<div class="4u 12u(mobile)">
								<section>
									<header>
										<h2>Contact Us</h2>
									</header>
									<ul class="divided">
										<li><a href="mailto:djanguars@gmail.com" target="_top">djanguars@gmail.com</a></li>
									</ul>
								</section>
							</div>
							<div class="4u 12u(mobile)">
								<section>
									<ul class="social">
										<li><a class="icon fa-facebook" href="http://facebook.com"><span class="label">Facebook</span></a></li>
										<li><a class="icon fa-twitter" href="http://twitter.com"><span class="label">Twitter</span></a></li>
										<li><a class="icon fa-dribbble" href="http://dribbble.com"><span class="label">Dribbble</span></a></li>
										<li><a class="icon fa-linkedin" href="http://linkedin.com"><span class="label">LinkedIn</span></a></li>
										<li><a class="icon fa-google-plus" href="http://plus.google.com"><span class="label">Google+</span></a></li>
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="12u">

								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>Copyright &copy; 2015 Yumi Kondo, Vania Budiman, Anya McGee, Steven Huang</li>
										</ul>
									</div>

							</div>
						</div>
					</section>
				</div>

		</div>

		<!-- Scripts -->
			<script src="{% static 'mealsOnWheels/js/jquery.min.js' %}"></script>
			<script src="{% static 'mealsOnWheels/js/jquery.dropotron.min.js' %}"></script>
			<script src="{% static 'mealsOnWheels/js/skel.min.js' %}"></script>
			<script src="{% static 'mealsOnWheels/js/skel-viewport.min.js' %}"></script>
			<script src="{% static 'mealsOnWheels/js/util.js' %}"></script>
			<!--[if lte IE 8]><script src="{% static 'mealsOnWheels/js/ie/respond.min.js' %}"></script><![endif]-->
			<script src="{% static 'mealsOnWheels/js/main.js' %}"></script>
			<script type="text/javascript" src="{%static 'mealsOnWheels/js/instafeed.min.js' %}"></script>

	</body>
</html>